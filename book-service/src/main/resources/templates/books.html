<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Books</title>
  <style>
    body { font-family: sans-serif; margin: 2em; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    a { text-decoration: none; padding: 10px 15px; background-color: #28a745; color: white; }
  </style>
</head>
<body>
<h1>Book List</h1>
<div style="margin-bottom: 1em;">
  <a th:href="@{/ui/books/add}">Add New Book</a>
</div>
<table>
  <thead>
  <tr>
    <th>ID</th>
    <th>Book Name</th>
    <th>Writer</th>
    <th>ISBN</th>
    <th>isAvailable?</th>
    <th>Transactions</th>

  </tr>
  </thead>
  <tbody>
  <tr th:each="book : ${bookList}">
    <td th:text="${book.id}">1</td>
    <td th:text="${book.bookName}">Book Name</td>
    <td th:text="${book.writer}">Writer Name</td>
    <td th:text="${book.isbn}">123456789</td>
    <td th:text="${book.available} ? 'Yes' : 'No'">Yes</td>
    <td>
      <button th:if="${book.available}"
              th:attr="onclick=|rentBook('${book.id}')|"
              class="rent-button">
        Rent
      </button>
      <button th:unless="${book.available}" disabled class="rent-button">
        Rented
      </button>
      <form th:action="@{/ui/books/delete/{id}(id=${book.id})}" method="post" style="display: inline-block; margin-left: 5px;">
        <button type="submit" class="delete-button" onclick="return confirm('Do you want to delete?')">
          Sil
        </button>
      </form>
    </td>
  </tr>
  </tbody>
</table>
<script>
  function rentBook(bookId) {
    const userId = prompt("Enter user id for rent:", "");

    if (userId === null || userId.trim() === "") {
      alert("user id mandatory.");
      return;
    }

    const rentalData = {
      bookId: parseInt(bookId),
      userId: parseInt(userId)
    };

    fetch('http://localhost:8080/api/rentals/rent', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(rentalData),
    })
            .then(response => {
              if (response.ok) {
                alert("Book rented!");
                window.location.reload();
              } else {
                response.json().then(err => {
                  alert("Error: " + (err.message || "Unkown erorr."));
                }).catch(() => {
                  alert("Error: " + response.statusText);
                });
              }
            })
            .catch((error) => {
              console.error('Error:', error);
              alert('Network Error.');
            });
  }
</script>
</body>
</html>